<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>현장관리자 페이지</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
    .container {
      max-width: 480px; margin: auto; background: #fff; padding: 15px;
      border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    h1 { text-align: center; margin-bottom: 20px; }
    input[type="text"] {
      width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px;
    }
    .button {
      padding: 8px 12px; border: none; border-radius: 5px; background-color: #007aff; color: #fff; cursor: pointer;
    }
    .button:hover { background-color: #005bb5; }
    .link-list div { margin-bottom: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="page-title">현장관리자 페이지</h1>
    <div id="field-link-list" class="link-list"></div>
    <input type="text" id="field-link-input" placeholder="교육자료 링크 입력">
    <button class="button" id="field-add-btn" onclick="addFieldLink()">링크 삽입하기</button>
    <br><br>
    <button class="button" onclick="showWorkerURL()">근로자용 페이지 수정하기</button>
    <p id="worker-url"></p>
    <br>
    <button class="button" onclick="goToLogin()">로그아웃</button>
  </div>

  <script>
    let fieldLinks = [];
    let currentField = "";
    // URL 쿼리 파라미터 추출 함수
    function getQueryParam(param) {
      let urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }
    window.onload = function(){
      currentField = getQueryParam("fieldName");
      if (!currentField) {
         alert("현장명이 없습니다.");
         window.location.href = "login.html";
         return;
      }
      document.getElementById("page-title").innerText = currentField + " 안전게시판";
      // localStorage의 fields 데이터에서 현재 현장 데이터 불러오기
      var fields = JSON.parse(localStorage.getItem("fields") || "[]");
      var thisField = fields.find(field => field.fieldName === currentField);
      if (thisField) {
         fieldLinks = thisField.fieldLinks || [];
         updateFieldLinks();
      }
    };
    function addFieldLink(){
      var input = document.getElementById("field-link-input");
      var url = input.value.trim();
      if(url === ""){
         alert("링크를 입력해주세요.");
         return;
      }
      if(fieldLinks.length < 3){
         fieldLinks.push(url);
         saveFieldLinks();
         updateFieldLinks();
         input.value = "";
      } else {
         alert("최대 3개의 링크만 등록 가능합니다.");
      }
    }
    function updateFieldLinks(){
      var listDiv = document.getElementById("field-link-list");
      listDiv.innerHTML = "";
      fieldLinks.forEach(function(link, index){
         var div = document.createElement("div");
         div.innerHTML = (index+1) + ". " + link + ' <button onclick="editFieldLink(' + index + ')">수정</button>';
         listDiv.appendChild(div);
      });
    }
    function editFieldLink(index){
      var newLink = prompt("새로운 링크를 입력해주세요:", fieldLinks[index]);
      if(newLink !== null && newLink.trim() !== ""){
         fieldLinks[index] = newLink.trim();
         saveFieldLinks();
         updateFieldLinks();
      }
    }
    function saveFieldLinks(){
      // fields 배열에서 현재 현장 데이터 업데이트
      var fields = JSON.parse(localStorage.getItem("fields") || "[]");
      fields = fields.map(field => {
         if(field.fieldName === currentField){
            field.fieldLinks = fieldLinks;
         }
         return field;
      });
      localStorage.setItem("fields", JSON.stringify(fields));
    }
    function showWorkerURL(){
      // 현장관리자 페이지에서 근로자용 페이지 URL 표시
      var workerPageURL = window.location.origin + window.location.pathname.replace("field.html", "worker.html") + "?fieldName=" + encodeURIComponent(currentField);
      document.getElementById("worker-url").innerText = "근로자용 페이지 URL: " + workerPageURL;
    }
    function goToLogin(){
      window.location.href = "login.html";
    }
  </script>
</body>
</html>